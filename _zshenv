# `.zshenv' is sourced on all invocations of the shell, unless the -f
# option is set. It should contain commands to set the command search
# path, plus other important environment variables. `.zshenv' should not
# contain commands that produce output or assume the shell is attached
# to a tty.

# Assign limits to children
unlimit
#limit stack 8192
#limit core 0

# limit per-process memory consumption to 128 Mbytes
#limit datasize 128m

# Assign previous limits to the shell itself
limit -s

umask 022

# remove nonexistent directories from an array.
rationalize-path ()
{
  # Note that this works only on arrays, not colon-delimited strings.
  # Not that this is a problem now that there is typeset -T.
  local element
  local build
  build=()
  # Evil quoting to survive an eval and to make sure that
  # this works even with variables containing IFS characters, if I'm
  # crazy enough to setopt shwordsplit.
  eval '
  foreach element in "$'"$1"'[@]"
  do
    if [[ -d "$element" ]]
    then
      build=("$build[@]" "$element")
    fi
  done
  '"$1"'=( "$build[@]" )
  '
}

# enable remote ssh X11 forwarding
if [ `uname -o` = "Cygwin" ]; then
  export DISPLAY=localhost:0.0
fi

# lang setup
export LC_ALL="en_US.UTF-8"
export LANG="en_US.UTF-8"
export LANGUAGE="en_US.UTF-8"

#export http_proxy=http://wwwgate0-ch.mot.com:1080
export ARCH=$CPUTYPE
export ZDOTDIR=~/.shell


if [ `uname -o` != "Cygwin" ]; then
  export JAVA_HOME=/usr/java/jdk1.7.0_45
else
  export JAVA_HOME="/cygdrive/c/Program Files/Java/jdk1.7.0_45"
fi

export JRE_HOME=$JAVA_HOME/jre
export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH
export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH

#export JAVA_HOME=/usr/java/jdk1.7.0_45
#export JRE_HOME=$JAVA_HOME/jre
export ANDROID_JAVA_HOME=$JAVA_HOME

export TERM=xterm
export LESS_TERMCAP_mb=$'\E[01;31m'
export LESS_TERMCAP_md=$'\E[01;31m'
export LESS_TERMCAP_me=$'\E[0m'
export LESS_TERMCAP_se=$'\E[0m'
export LESS_TERMCAP_so=$'\E[01;44;33m'
export LESS_TERMCAP_ue=$'\E[0m'
export LESS_TERMCAP_us=$'\E[01;32m'

typeset -TU LD_LIBRARY_PATH ld_path  # Tie array to LD path

path=( ~/bin $path ~/bin/repo_dir{,/$ARCH} /usr/local/bin )
path=( $path /bin /usr/bin /sbin /usr/sbin /usr/local/sbin /usr/local/share/bin )
rationalize-path path

ld_path=( /usr/local/lib $ld_path )

# Remove duplicates
typeset -U path cdpath manpath fpath ld_path


CYGWIN="${CYGWIN} nodosfilewarning winsymlinks:native"; export CYGWIN
